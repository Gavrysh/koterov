<?php ## Модель процесса-письменника
$file = 'file.txt';

//Спочатку створимо пустий файл, ЯКЩО ВІН ЩЕ НЕ ІСНУЄ
//Якщо файл вже існує, - це його не зруйнує
fclose(fopen($file, 'a+b'));

//Блокуємо файл
$f = fopen($file, 'r+b') or die('Помилка відкриття файлу');
flock($f, LOCK_EX); //очикуємо, поки ми не станемо єдиними

//...
//У цій точці ми можемо бути впевнені у тому, що тільки ця програма
//працює з файлом
//...

//Усе зроблено, знімаємо блокування
fclose($f);